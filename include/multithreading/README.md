# Пул потоков

## Описание
Реализованный пул потоков предоставляет возможность не запускать для каждой задачи отдельный поток, а держать несколько постоянно работающих (спящих,  если задач нет) потоков, которые выполняют поступившие задачи.

## Интерфейс
Класс `ThreadPool` предоставляет следующие методы:
- `ThreadPool(size_t num_threads)` - конструктор, создающий пул из `num_threads` потоков.
- `~ThreadPool()` - деструктор, завершающий все потоки. Он останавливает получение новых задач для потока, ожидается завершение всех взятых для выполнения задач, после чего завершаются все потоки.
- `std::future<R> add_task(F&& f, Args&&... args)` - добавляет задачу в пул. Возвращает `std::future`, который будет содержать результат выполнения задачи. Параметры и `args` передаются в функцию `f` при ее выполнении. Существует одно ограничение: тип F должен быть копируемым. 

## Детали реализации
Задачи хранятся в виде объектов класса `Task`. Используется стандартная не потокобезопасная очередь из stl, поэтому для работы с ней используется `std::mutex`. Также, для ожидания новых задач используется `std::condition_variable`.

Класс `Task` является оберткой для функции, передаваемой в `add_task`. Сам класс не шаблонный, однако, он имеет шаблонный конструктор, что позволяет передавать в него любые функции с любым количеством параметров. Внутри него создается лямба-обертка для выполнения задачи, и сохраняется в поле типа std::future. Когда понадобится выполнить задачу, достаточно вызвать оператор `()`, который выполнит задачу и положит в соответствующее `std::future` через `std::promise` результат выполнения. 

Если у потоков нет задач, они все блокируются на `std::condition_variable`, ожидая появления новой задачи. Когда задача появляется, один из потоков просыпается и начинает выполнение задачи. Это позволяет не тратить ресурсы на бесконечное выполнение пустого цикла, а также не тратить ресурсы на создание и уничтожение потоков.

## Возможные улучшения
- Переписать очередь задач на lock-free очередь.
- Добавить возможность остановить пул потоков и возобновить его работу.
- Добавить возможность установить максимальное время ожидания выполнения задачи.
- Добавить возможность выполнять не только копируемые функторы.